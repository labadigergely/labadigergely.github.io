---
title: Távoli olvasó olvas
layout: post
categories: szovegek
tags: R distant&nbsp;reading tutorial
---

Az utóbbi időben igyekeztem elmélyülni a [`distant reading`][distant] elméletében és gyakorlatában. Az elmélet megismerése a szokásos utakon-módokon zajlik. Könyvek, tanulmányok különböző szerzők elolvasása, kijegyzetelése. Aztán cikkek, recenziók írása, előadások, szemináriumok tartása... Ja igen, néha töprengeni, mélázni sem árt a kijegyzetteken, elmondottakon. Szóval ahogy a bölcsészek csinálják.

A gyakorlat... Nyilván már egy excell-táblázat is alkalmas erre, de azért vannak ennél kifinomultabb és hajlékonyabb, illetve alkalmasabb eszközök. Még én is tanulom őket. Docendo discimus. Persze magamat tanítom – végtelen hurok. Különösebb felkészülés nélkül elő lehet venni Maciej Eder, Jan Rybicki és Mike Kestemont programcsomagját, a [`stylo`][stylo]-t. Persze telepíteni kell hozzá az [`R`][r]-t Erről hosszabban nem kell írni, elég jó dokumentációja van, tanulmányok mellé. Stilometriára lehet használni. Ennek nemcsak a szerzőségattribúcióban van jelentősége, vannak további lehetőségei – erről többen hosszabban írtak. Matthew L. Jockers vagy éppen a [Distant readings](https://books.google.hu/books/about/Distant_Readings.html?id=0vE-AwAAQBAJ&redir_esc=y) tanulmányai – érdemes az utóbbiak magyarázatait hozzáolvasni. Magyar szövegeket is kezel: `.txt` vagy `.xml` formátumban.

De ha magunk akarunk távoli olvasni, akkor érdemes belevetni magunkat az `R` használatába. Nekem [Matthew Jockers könyve](http://www.matthewjockers.net/text-analysis-with-r-for-students-of-literature/) volt az útmutató. Az ő példáit alkalmazom, módosításokkal.

## 1. Előfeltételek
Ebben a leírásban adottnak veszem, hogy telepítve van az [`R`][r] és az [`RStudio`][rstudio]. Nem fogom elmagyarázni az egyes `R`-adattípusokat (`data.frame`, `list`, `character` stb.), ebben a részben nincs is rá szükség. Továbbá le kell még tölteni egy egyszerű `java`-programot is, a [`magyarlanc`][magyarlanc]-ot.

## 2. Szövegelőkészítés
A [`magyarlanc`][magyarlanc] egy `java`-program, amelyet a [SZTE és az MTA Mesterséges Intelligencia Kutatócsoportja](http://rgai.inf.u-szeged.hu) készített. Ingyen letölthető, de szükséges, hogy a [java8](http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html) telepítve legyen. Általában fent van a gépeken. Morfológiai elemzést készít.

### A `magyarlanc` használata
- Miután letöltöttük, az egyszerűség kedvéért érdemes abba a könyvtárba másolni, amelyikben a feldolgozandó fájlunk van.
- Be kell hívni a parancssort/terminált és át kell menni abba a könyvtárba, ahol a `magyarlanc` található. (Ha valaki elfelejtette volna, a `cd` paranccsal [change directory] lehet könyvtárat váltani.)
- A szövegnek `.txt` formátumban kell lennie. A [`magyarlanc`] 19. századi szövegekkel is jól elbodogul, de pontosabb, ha sztenderdizálva van a szöveg. Tehát a `ts`, `tz`, `cz` és társaikat normalizálni érdemes.
- A futtatás egyszerű, gépeljük/másoljuk be a következő parancsot:

```R
java -Xmx1G -jar magyarlanc-3.0.jar -mode morphparse -input in.txt -output out.txt
```

> - A [`magyarlanc`][magyarlanc] honlapján van egy részletesebb leírás arról, hogy milyen opciókat lehet bekapcsolni – én a `morphparse`-ot szoktam használni.
>  - Az `in.txt` helyén értelemszerűen a feldolgozandó szövegfájlunk neve álljon. Valójában nem kell egy könyvtárban lennie a `magyarlanc`-nak a fájllal, de akkor a `magyarlanc` felőli elérési utat kell megadni az `in.txt` helyén.
> - Az `out.txt` a kimeneti fájl. Értelemszerűen az elérési utat és nevet is lehet módosítani.
> - Így néz ki *Az arany ember* eleje a `magyarlanc`-cal elemezve:

![Az arany ember elemzése](https://cloud.githubusercontent.com/assets/8556223/20868083/f4721052-ba52-11e6-9283-b02371e9886e.png)

> - Négy oszlopot tartalmaz, amelyeket tabulátor választ el. Az első az eredeti szöveg. A második a lemmatizált (szótári) szóalak. A harmadik a szófaj<sup>[*](#myfootnote*)</sup>. A negyedik a morfológiai elemzés.

### Beolvasás az `R`-be
- Miután megnyitottuk az `RStudio`-t, állítsuk be a munkakönyvtárat.
    - Az aktuális munkakönyvtárat a `getwd()` paranccsal lehet lekérdezni.
    - Munkakönyvtárat beállítani a `setwd(konyvtareleresiutja)` paranccsal lehet vagy a `Session` menü `Set Working Directory` alpontjában.
- Töltsük be a `magyarlanc`-cal feldolgozott fájlt:

```R
valtozo.df <- read.csv2(file = "out.txt", header = FALSE, sep = "\t", stringsAsFactors = FALSE)
```

> - Egy `valtozo.df` nevű `data.frame`-be (praktikusan: táblázat) olvassuk be a fájlt (a `<-` helyett használhatunk `=`).
> - Az első argumentum a fájl elérési útja és neve (jelen esetben a fájl a munkakönyvtárban van).
> - A másodikkal azt mondjuk, hogy az első sort ne tekintse fejlécnek.
> - A harmadikkal, hogy az elemeket tabulátor választja el (egy "rendes" `.csv` esetében  `","`-t kel írni, mivel vessző a választóelem [`comma separated values`]).
> - A negyedikkel, hogy az azonos alakokat ne ejtse ki, hanem mindet tartsa meg. Az `R` alapesetben ugyanis az ismétlődő alakokat kiejtené.

### Alapműveletek
- Ha lekérdezzük, kiderül, hogy *Az arany ember*-t tartalmazó fájlunknak 179705 sora és 5 oszlopa van.

```R
\> dim(valtozo.df)
[1] 179705      5
```

- Ha kiíratjuk a változó elejét, akkor látjuk, hogy az ötödik oszlop valójában üres. Ezt akár törölhetjük is. Utána ellenőrizzük!

```R
\> head(valtozo.df, n = 5)
       V1      V2   V3                               V4 V5
1       A       a  DET        Definite=Def|PronType=Art NA
2   SZENT   szent  ADJ  Case=Nom|Degree=Pos|Number=Sing NA
3 BORBÁLA borbála NOUN             Case=Nom|Number=Sing NA
4      I.      1.  ADJ Case=Nom|NumType=Ord|Number=Sing NA
5       A       a  DET        Definite=Def|PronType=Art NA
\> valtozo.df$V5 = NULL
```
A változóból bármelyik oszlopot (sort) exportálni lehet, hogy további elemzéseknek vessük alá (pl. ha a szófajok érdekelnek, vagy ha a morfológiai elemzések [mennyi jelen idejű ige van és mennyi múlt idejű...]), a következő parancs a lemmatizált alakokat teszi egy egyoszlopos data.frame-be: `lemma.valtozo.df = valtozo.df[2]`, vagy: `lemma.valtozo.df = valtozo.df["V2]`
- a változónk annyi sora van, ahány lemma volt a fájlba
- ha valamelyik oszlopot az eredeti data.frame-ből törölni akarjuk (a példában az ötödiket), akkor így kell: `lemma.valtozo.df$V5 = NULL`
- a data.frame típusú adatból így lehet karaktervektort csinálni: `vektornev = unlist(lemma.valtozo.df, use.names = FALSE)`

Egy csomó mindent még tanulni kell. Majd máskor.

[distant]: https://www.google.hu/search?client=safari&rls=en&q=distant+reading&ie=UTF-8&oe=UTF-8&gfe_rd=cr&ei=7c9DWNqCHKve8geiuL-4DA#newwindow=1&q=distant+reading
[stylo]: https://sites.google.com/site/computationalstylistics/
[r]: https://www.r-project.org
[magyarlanc]: http://www.inf.u-szeged.hu/rgai/magyarlanc
[rstudio]: https://www.rstudio.com
<a name="myfootnote*">*</a>: Nem pontos kifejezés, tudom.
